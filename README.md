# 🧠 虎鲸笔记思维导图插件

一个为虎鲸笔记（Orca Notes）开发的思维导图插件，可以将页面内容转换为交互式思维导图。

## ✨ 功能特性

- 🎯 **一键转换**: 将整个页面内容转换为思维导图
- 🗂️ **智能过滤**: 自动跳过表格内容，专注于文本结构
- 🎨 **主题适配**: 自动适配虎鲸笔记的深色/浅色主题
- 🔍 **缩放控制**: 支持按钮缩放和 Ctrl+滚轮缩放
- ⌨️ **快捷键**: ESC键快速退出思维导图模式
- 📱 **响应式**: 全屏显示，适配不同屏幕尺寸

## 🚀 快速开始

### 安装

1. 下载 `dist/index.js` 文件
2. 在虎鲸笔记中加载插件
3. 点击右上角的 🧠 按钮切换思维导图模式

## 🎮 操作方式

- **退出思维导图**: 按 `ESC` 键 或 点击 ✕ 按钮
- **缩放控制**: 
  - 使用界面上的 `+`/`-` 按钮
  - 按住 `Ctrl` + 滚动鼠标滚轮

## 🛠️ 开发说明

### 项目结构

```
outline-plugin/
├── src/
│   ├── main.ts              # 插件主入口
│   ├── types.ts             # 类型定义
│   ├── components/
│   │   └── MindMap.ts       # 思维导图渲染器
│   ├── utils/
│   │   └── helpers.ts       # 工具函数
│   ├── styles/
│   │   └── main.css         # 样式文件
│   └── __tests__/           # 测试文件
├── dist/
│   ├── index.js             # 编译后的主文件
│   └── style.css            # 编译后的样式
├── icon.png                 # 插件图标
├── package.json             # 项目配置
└── README.md                # 说明文档
```

### 构建命令

```bash
# 安装依赖
npm install

# 开发模式（监听文件变化）
npm run dev

# 构建生产版本
npm run build

# 运行测试
npm test

# 清理构建文件
npm run clean
```

## 📦 技术栈

- **TypeScript**: 主要开发语言
- **Markmap**: 思维导图渲染库
- **Vite**: 构建工具
- **D3.js**: 图形渲染（Markmap依赖）

## 🐛 问题修复

### v4.0.0 重要修复
- ✅ 修复了关闭思维导图后编辑器回车键和缩进失效的严重问题
- ✅ 改用覆盖层方式而非DOM替换，保护原始编辑器事件绑定
- ✅ 增强了事件清理机制，彻底解决键盘事件劫持
- ✅ 添加了表格内容过滤功能
- ✅ 优化了主题适配和缩放体验
- ✅ 移除启动通知，保持界面简洁

## 📋 API 接口

插件使用虎鲸笔记提供的标准API：

- `orca.state.blocks` - 获取笔记块数据
- `orca.commands` - 命令注册和管理
- `orca.toolbar` - 工具栏按钮集成
- `orca.nav` - 面板管理
- `orca.notify` - 用户通知
- `orca.broadcasts` - 事件系统

## 🔧 配置选项

插件提供以下配置选项：

- **自动刷新**：内容变化时是否自动更新视图
- **最大层级**：限制显示的最大层级数
- **显示主题**：选择明暗主题或跟随系统

## 🎯 使用场景

- 📝 **大型笔记梳理**：快速了解复杂笔记的整体结构
- 🔍 **内容导航**：通过大纲快速定位到具体内容
- 📊 **知识架构**：可视化知识体系和思维框架
- ✏️ **写作辅助**：文章、报告的结构规划和调整

## 🔒 权限说明

插件需要以下权限：

- `read-blocks`：读取笔记块数据
- `write-ui`：创建和管理UI界面
- `store-data`：保存插件配置和状态

## 🐛 问题反馈

如遇到问题或有功能建议，请：

1. 检查虎鲸笔记版本是否 >= 1.5.0
2. 查看浏览器开发者工具中的错误信息
3. 重启虎鲸笔记应用
4. 联系插件开发者

## 📄 许可证

MIT License

---

**开发者**：jlhulclq  
**版本**：4.0.0  
**兼容性**：虎鲸笔记 1.5.0+

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！